<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <!-- IE -->
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- 取消 safari 電話連結 -->
    <meta name="format-detection" content="telephone=no">

    <title>THAIWAN</title>

    <meta name="Description" content="Description">
    <meta property="og:type" content="og:type">
    <meta property="og:url" content="og:url">
    <meta property="og:title" content="og:title">
    <meta property="og:description" content="og:description">
    <meta property="og:image" content="og:image">

    <!-- favicon -->
    <!-- <link rel="apple-touch-icon" sizes="180x180" href="img/favicon/apple-touch-icon.png"> -->
    <link rel="icon" type="image/x-icon" href="img/static/logo/favicon.ico" />
    <!-- swiper -->
    <link rel="stylesheet" type="text/css" href="libs/swiper/swiper-bundle.min.css" />
    <!-- style.css -->
    <link rel="stylesheet" type="text/css" media="all" href="css/style.css" />
    <!-- fontawesome -->
    <script src="libs/fontawesome-pro-6.1.1-web/js/all.min.js"></script>
    <style>
        body {
    margin: 0;
    padding: 0;
    font-family: Arial, Helvetica, sans-serif;
}
#map-canvas {
    height: 450px;
}
#overlay {
    position: absolute;
    width: 200px;
    height: 450px;
    background: black;
    opacity: 0.8;
    top: 0;
    left: 0;
    overflow: auto;
}
#overlayContent {
    color: white;
    padding: 10px 20px;
}
#overlayContent p {
    font-size: 12px;
    margin: 6px 0;
}
small {
    font-size: 9px;
}
#overlayContent small {
    display: block;
    text-align: right;
    font-style: italic;
}
i {
    color: lightblue;
}
h1 {
    font-size: 20px;
}
h5 {
    font-size: 12px;
}
button {
    margin: 20px 0 0 20px;
}
    </style>
</head>

<body>
    <h1 class="visuallyhidden">THAIWAN</h1>
    <!-------------------- wrapper START -------------------->
    <!-- 首頁wrapper class="wrapper index" -->
    <!-- 首頁wrapper class="wrapper pg" -->
    <div class="wrapper index">
        <main>
            <!-- 聯絡我們 -->
            <section class="contact">
                <div id="overlay">
                    <div id="overlayContent">
                         <h1>DIV OVERLAY</h1>
                
                         <h5>Routes should not be drawn below this element.</h5>
                
                         <h5>Click the <i>Calc route</i> button to draw the directions route.</h5>
                
                         <h5><i>Map offset</i> will be applied automatically.</h5>
                
                         <h5><i>Drag the route</i> to see how it is applied.</h5>
                
                         <h5>Click the <i>Offset map</i> button to reapply the offset.</h5>
                
                         <h5>Click the <i>Fit only</i> button to only fit route bounds.</h5>
                
                         <h5>Click the <i>Fit and offset map</i> button to fit to route bounds and reapply offset.</h5>
                
                    </div>
                    <button id="calcRoute">Calc route</button>
                    <button id="offsetMap">Offset map</button>
                    <button id="fitMap">Fit only</button>
                    <button id="fitAndOffsetMap">Fit and offset map</button>
                </div>
            </section>
        </main>

        <!-- footer -->
        <footer>
            <p>Copyright © KASSER 2023</p>
        </footer>
        <div class="overlay black"></div>
        <div class="mobile_search__input">
            <div class="input_wrapper">
                <input type="text">
                <i class="fa-solid fa-magnifying-glass"></i>
            </div>
            <button type="button" class="search_btn"></button>
            <button type="button" class="close">
                <i class="fa-solid fa-xmark"></i>
            </button>
        </div>
    </div>
    <!-------------------- wrapper END -------------------->


    <!-- jquery -->
    <script src="libs/jquery/jquery-3.6.1.min.js"></script>
    <!-- bs.js -->
    <script src="libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- swiper -->
    <script src="libs/swiper/swiper-bundle.min.js"></script>
    <!-- 共用js -->
    <script src="js/common.js"></script>
    <!-- 首頁js -->
    <script src="js/index.js"></script>
    <script>
        var directionsDisplay;
        var directionsService = new google.maps.DirectionsService();
        var map;
        var routeBounds = false;
        var overlayWidth = 200; // Width of the overlay DIV
        var leftMargin = 30; // Grace margin to avoid too close fits on the edge of the overlay
        var rightMargin = 80; // Grace margin to avoid too close fits on the right and leave space for the controls

        overlayWidth += leftMargin;

        var start = new google.maps.LatLng(48.857380, 2.351717);
        var end = new google.maps.LatLng(50.108814, 8.672309);

        function initialize() {

            var btn1 = document.getElementById('calcRoute');
            btn1.addEventListener('click', calcRoute);

            var btn2 = document.getElementById('offsetMap');
            btn2.addEventListener('click', offsetMap);

            var btn3 = document.getElementById('fitAndOffsetMap');
            btn3.addEventListener('click', fitAndOffsetMap);

            var btn4 = document.getElementById('fitMap');
            btn4.addEventListener('click', fitMap);

            directionsDisplay = new google.maps.DirectionsRenderer({
                draggable: true
            });

            var mapOptions = {
                zoom: 13,
                mapTypeId: google.maps.MapTypeId.ROADMAP,
                center: start,
                panControlOptions: {
                    position: google.maps.ControlPosition.TOP_RIGHT
                },
                zoomControlOptions: {
                    position: google.maps.ControlPosition.TOP_RIGHT
                }
            };

            map = new google.maps.Map(document.getElementById("map-canvas"), mapOptions);
            directionsDisplay.setMap(map);
        }

        function offsetMap() {

            if (routeBounds !== false) {

                // Clear listener defined in directions results
                google.maps.event.clearListeners(map, 'idle');

                // Top right corner
                var topRightCorner = new google.maps.LatLng(map.getBounds().getNorthEast().lat(), map.getBounds().getNorthEast().lng());

                // Top right point
                var topRightPoint = fromLatLngToPoint(topRightCorner).x;

                // Get pixel position of leftmost and rightmost points
                var leftCoords = routeBounds.getSouthWest();
                var leftMost = fromLatLngToPoint(leftCoords).x;
                var rightMost = fromLatLngToPoint(routeBounds.getNorthEast()).x;

                // Calculate left and right offsets
                var leftOffset = (overlayWidth - leftMost);
                var rightOffset = ((topRightPoint - rightMargin) - rightMost);

                // Only if left offset is needed
                if (leftOffset >= 0) {

                    if (leftOffset < rightOffset) {

                        var mapOffset = Math.round((rightOffset - leftOffset) / 2);

                        // Pan the map by the offset calculated on the x axis
                        map.panBy(-mapOffset, 0);

                        // Get the new left point after pan
                        var newLeftPoint = fromLatLngToPoint(leftCoords).x;

                        if (newLeftPoint <= overlayWidth) {

                            // Leftmost point is still under the overlay
                            // Offset map again
                            offsetMap();
                        }

                    } else {

                        // Cannot offset map at this zoom level otherwise both leftmost and rightmost points will not fit
                        // Zoom out and offset map again
                        map.setZoom(map.getZoom() - 1);
                        offsetMap();
                    }
                }
            }
        }

        function fromLatLngToPoint(latLng) {

            var scale = Math.pow(2, map.getZoom());
            var nw = new google.maps.LatLng(map.getBounds().getNorthEast().lat(), map.getBounds().getSouthWest().lng());
            var worldCoordinateNW = map.getProjection().fromLatLngToPoint(nw);
            var worldCoordinate = map.getProjection().fromLatLngToPoint(latLng);

            return new google.maps.Point(Math.floor((worldCoordinate.x - worldCoordinateNW.x) * scale), Math.floor((worldCoordinate.y - worldCoordinateNW.y) * scale));
        }

        function calcRoute() {

            var request = {
                origin: start,
                destination: end,
                travelMode: google.maps.DirectionsTravelMode.DRIVING
            };

            directionsService.route(request, function (response, status) {

                if (status == google.maps.DirectionsStatus.OK) {

                    directionsDisplay.setDirections(response);

                    // Define route bounds for use in offsetMap function
                    routeBounds = response.routes[0].bounds;

                    // Write directions steps
                    writeDirectionsSteps(response.routes[0].legs[0].steps);

                    // Wait for map to be idle before calling offsetMap function
                    google.maps.event.addListener(map, 'idle', function () {

                        // Offset map
                        offsetMap();
                    });

                    // Listen for directions changes to update bounds and reapply offset
                    google.maps.event.addListener(directionsDisplay, 'directions_changed', function () {

                        // Get the updated route directions response
                        var updatedResponse = directionsDisplay.getDirections();

                        // Update route bounds
                        routeBounds = updatedResponse.routes[0].bounds;

                        // Fit updated bounds
                        map.fitBounds(routeBounds);

                        // Write directions steps
                        writeDirectionsSteps(updatedResponse.routes[0].legs[0].steps);

                        // Offset map
                        offsetMap();
                    });
                }
            });
        }

        function writeDirectionsSteps(steps) {

            var overlayContent = document.getElementById("overlayContent");
            overlayContent.innerHTML = '';

            for (var i = 0; i < steps.length; i++) {

                overlayContent.innerHTML += '<p>' + steps[i].instructions + '</p><small>' + steps[i].distance.text + '</small>';
            }
        }

        function fitMap() {

            if (routeBounds !== false) {

                map.fitBounds(routeBounds);
            }
        }

        function fitAndOffsetMap() {

            if (routeBounds !== false) {

                map.fitBounds(routeBounds);
                offsetMap();
            }
        }

        initialize();
    </script>
</body>

</html>

        